<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –ø–∞–º—è—Ç–Ω–∏–∫–æ–≤</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  #map {
    width: 100%;
    height: 100%;
  }

  /* üìå –ö–∞—Ä—Ç–æ—á–∫–∞ –æ–±—ä–µ–∫—Ç–∞ */
  #infoCard {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 260px;
    background: white;
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    font-family: sans-serif;
    box-shadow: 0px 4px 15px rgba(0,0,0,0.25);
    opacity: 0;
    pointer-events: none;
    transition: opacity .3s;
  }

  #infoCard.active {
    opacity: 1;
    pointer-events: auto;
  }

  #infoCard button {
    margin-top: 8px;
    width: 100%;
    border: none;
    background: #3a86ff;
    color: white;
    padding: 8px;
    font-size: 14px;
    border-radius: 8px;
    cursor: pointer;
  }

  #infoCard button:hover {
    background: #2d73d9;
  }
</style>
</head>
<body>

<div id="map"></div>
<div id="infoCard">
  <div id="monName">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
  <button id="openBtn">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([40, 20], 2);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 18,
  attribution: '¬© OpenStreetMap'
}).addTo(map);

const monuments = [
  { name: "–ü–µ—â–µ—Ä–∞ —Ä—É–∫", coords: [-48.7983, -72.6403] },
  { name: "–ö–æ–ª–∏–∑–µ–π", coords: [41.8902, 12.4922] },
  { name: "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞", coords: [59.9398, 30.3146] },
  { name: "–°–æ–±–æ—Ä –®–∞—Ä—Ç—Ä", coords: [48.4474, 1.4870] },
  { name: "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –§–ª–æ—Ä–µ–Ω—Ü–∏–∏", coords: [43.7696, 11.2558] },
  { name: "–†–∏—Å–æ–≤—ã–µ —Ç–µ—Ä—Ä–∞—Å—ã –§–∏–ª–∏–ø–ø–∏–Ω—Å–∫–∏—Ö –ö–æ—Ä–¥–∏–ª—å–µ—Ä", coords: [16.9310, 121.0550] },
  { name: "–ü–µ—â–µ—Ä—ã –õ–∞—Å–∫–æ", coords: [45.0541, 1.1674] },
  { name: "–ú–µ–º–æ—Ä–∏–∞–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å –ê—É—à–≤–∏—Ü-–ë–∏—Ä–∫–µ–Ω–∞—É", coords: [50.0359, 19.1783] },
  { name: "–°–∏–¥–Ω–µ–π—Å–∫–∏–π –æ–ø–µ—Ä–Ω—ã–π —Ç–µ–∞—Ç—Ä", coords: [-33.8568, 151.2153] },
  { name: "–ù–µ—Å–≤–∏–∂—Å–∫–∏–π –∑–∞–º–æ–∫", coords: [53.2224, 26.6913] },
  { name: "–í–µ–ª–∏–∫–∞—è –ö–∏—Ç–∞–π—Å–∫–∞—è —Å—Ç–µ–Ω–∞", coords: [40.4319, 116.5704] },
  { name: "–ú–∞—á—É-–ü–∏–∫—á—É", coords: [-13.1631, -72.5450] },
  { name: "–ì—Ä–∞–Ω–¥-–ö–∞–Ω—å–æ–Ω", coords: [36.0544, -112.1401] },
  { name: "–ü–µ—Ç—Ä–∞", coords: [30.3285, 35.4444] },
  { name: "–¢–∞–¥–∂-–ú–∞—Ö–∞–ª", coords: [27.1751, 78.0421] },
  { name: "–ü–∏—Ä–∞–º–∏–¥—ã –ì–∏–∑—ã", coords: [29.9792, 31.1342] },
  { name: "–ì–∞–ª–∞–ø–∞–≥–æ—Å—Å–∫–∏–µ –æ—Å—Ç—Ä–æ–≤–∞", coords: [-0.9538, -90.9656] },
  { name: "–î–æ–ª–∏–Ω—ã –ë–∞–º–∏–∞–Ω", coords: [34.8269, 67.8276] }
];

const infoCard = document.getElementById("infoCard");
const monName = document.getElementById("monName");
const openBtn = document.getElementById("openBtn");

let selectedMonument = "";

monuments.forEach(m => {
  const marker = L.marker(m.coords).addTo(map);

  // –Ø—Ä–ª—ã–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º
  const tooltipHtml = `
    <span style="
      background:white;
      padding:2px 6px;
      border-radius:4px;
      font-weight:bold;
      cursor:pointer;
    ">
      ${m.name}
    </span>`;

  marker.bindTooltip(tooltipHtml, {
    permanent: true,
    direction: "top",
    offset: [0, -12],
    opacity: 1
  }).openTooltip();

  // ‚úÖ –ö–ª–∏–∫ –ø–æ –º–∞—Ä–∫–µ—Ä—É —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
  marker.on("click", () => {
  const destUrl = `/all_HTML/destination.html?name=${encodeURIComponent(m.name)}`;

  // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º cookie
  document.cookie = `selectedMonument=${encodeURIComponent(m.name)}; path=/; max-age=86400`;

  // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –ø–æ–ª–Ω–æ–º –æ–∫–Ω–µ (–µ—Å–ª–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è same-origin)
  try {
    if (window.top && window.top !== window.self) {
      window.top.location.href = destUrl;
      return;
    }
  } catch (e) {}

  // –ï—Å–ª–∏ –≤ iframe –∏ –¥–æ—Å—Ç—É–ø –∫ top –∑–∞–ø—Ä–µ—â—ë–Ω ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —Ä–æ–¥–∏—Ç–µ–ª—é
  if (window.parent && window.parent !== window.self) {
    window.parent.postMessage({
      type: "openDestination",
      url: destUrl,
      name: m.name
    }, "*");
    return;
  }

  // –ï—Å–ª–∏ –Ω–µ –≤ iframe ‚Äî –æ–±—ã—á–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
  window.location.href = destUrl;
});
});
</script>

</body>
</html>
